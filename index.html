<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <!-- notch-friendly + mobile-first -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Planner de Jornadas</title>
  <meta name="description" content="Planner de jornadas con horas efectivas (descuenta almuerzo cuando aplica). Calendario, semana, totales y KPIs." />
  <meta name="theme-color" content="#f1f5f9" />
  <meta name="color-scheme" content="light" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Accesibilidad: saltar navegaci√≥n -->
  <a class="skip-link" href="#appMain" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
    Saltar al contenido
  </a>

  <div class="wrap">
    <!-- TOP -->
    <header class="top" role="banner">
      <div class="brand" aria-label="Planner">
        <div class="logoDot" aria-hidden="true"></div>
        <div>
          <div class="brandTitle">Planner</div>
          <div class="brandSub">Horas efectivas (sin inflar con almuerzo) üçΩÔ∏è</div>
        </div>
      </div>

      <div class="monthNav" aria-label="Navegaci√≥n de mes">
        <button id="prevMonth" class="btn" type="button" aria-label="Mes anterior">‚óÄ</button>
        <div class="monthLabel" id="monthLabel" aria-live="polite">Mes</div>
        <button id="nextMonth" class="btn" type="button" aria-label="Mes siguiente">‚ñ∂</button>
      </div>
    </header>

    <!-- TABS -->
    <nav class="tabsRow" role="tablist" aria-label="Secciones del Planner">
      <div class="tabsLeft" aria-label="Pesta√±as">
        <button
          class="tabBtn isActive"
          type="button"
          id="tab-main"
          data-tab="main"
          role="tab"
          aria-selected="true"
          aria-controls="panel-main"
        >
          üìÖ Calendario y semana
        </button>

        <button
          class="tabBtn"
          type="button"
          id="tab-totals"
          data-tab="totals"
          role="tab"
          aria-selected="false"
          aria-controls="panel-totals"
        >
          üßÆ Totales
        </button>

        <button
          class="tabBtn"
          type="button"
          id="tab-kpiMonth"
          data-tab="kpiMonth"
          role="tab"
          aria-selected="false"
          aria-controls="panel-kpiMonth"
        >
          üìà KPIs mensuales
        </button>

        <button
          class="tabBtn"
          type="button"
          id="tab-kpiYear"
          data-tab="kpiYear"
          role="tab"
          aria-selected="false"
          aria-controls="panel-kpiYear"
        >
          üóìÔ∏è KPIs anuales
        </button>

        <button
          class="tabBtn"
          type="button"
          id="tab-details"
          data-tab="details"
          role="tab"
          aria-selected="false"
          aria-controls="panel-details"
        >
          üîç Detalles
        </button>
      </div>

      <div class="legendNote" aria-label="Gu√≠a visual">
        <div class="legendHelp">
          Gu√≠a visual: <b>Azul</b> = con jornada. <b>Blanco</b> = sin jornada.
          <br />Gris claro = celdas fuera del mes (relleno del calendario).
        </div>
      </div>
    </nav>

    <main id="appMain" role="main">
      <!-- PANEL: MAIN -->
      <section
        class="panel"
        id="panel-main"
        data-panel="main"
        role="tabpanel"
        aria-labelledby="tab-main"
      >
        <!-- CALENDAR -->
        <section class="card" aria-label="Calendario">
          <div class="card__head">
            <div>
              <h2>Calendario</h2>
              <div class="sub">
                Todas las horas mostradas son <b>efectivas</b>
                (si supera 6h, se descuenta 1h de almuerzo).
              </div>
            </div>

            <div class="legend" aria-label="Leyenda del calendario">
              <span class="chip chip--on">Con jornada</span>
              <span class="chip">Sin jornada</span>
            </div>
          </div>

          <div class="calendar">
            <div class="calendarHead" aria-hidden="true">
              <div class="calDay">Lun</div>
              <div class="calDay">Mar</div>
              <div class="calDay">Mi√©</div>
              <div class="calDay">Jue</div>
              <div class="calDay">Vie</div>
              <div class="calDay">S√°b</div>
              <div class="calDay">Dom</div>
            </div>

            <div id="calendarGrid" class="calendarGrid" aria-label="D√≠as del mes">
              <!-- app.js llena esto -->
            </div>
          </div>
        </section>

        <!-- WEEK -->
        <section class="card" aria-label="Carga por semana">
          <div class="card__head">
            <div>
              <h2>Carga por semana</h2>
              <div class="sub" id="weekLabel" aria-live="polite">Semana ¬∑ Del --/-- al --/--</div>
            </div>

            <div class="actions" aria-label="Navegaci√≥n por semanas">
              <button id="prevWeek" class="btn" type="button" aria-label="Semana anterior">‚óÄ Semana</button>
              <button id="nextWeek" class="btn" type="button" aria-label="Semana siguiente">Semana ‚ñ∂</button>
            </div>
          </div>

          <div class="weekChart" aria-label="Barras por d√≠a de la semana">
            <div class="dayBar">
              <div class="bar" id="bar-lun" aria-label="Lunes"></div>
              <div class="dayName">Lun</div>
              <div class="dayHours" id="hours-lun">0.0h</div>
            </div>

            <div class="dayBar">
              <div class="bar" id="bar-mar" aria-label="Martes"></div>
              <div class="dayName">Mar</div>
              <div class="dayHours" id="hours-mar">0.0h</div>
            </div>

            <div class="dayBar">
              <div class="bar" id="bar-mie" aria-label="Mi√©rcoles"></div>
              <div class="dayName">Mi√©</div>
              <div class="dayHours" id="hours-mie">0.0h</div>
            </div>

            <div class="dayBar">
              <div class="bar" id="bar-jue" aria-label="Jueves"></div>
              <div class="dayName">Jue</div>
              <div class="dayHours" id="hours-jue">0.0h</div>
            </div>

            <div class="dayBar">
              <div class="bar" id="bar-vie" aria-label="Viernes"></div>
              <div class="dayName">Vie</div>
              <div class="dayHours" id="hours-vie">0.0h</div>
            </div>

            <div class="dayBar">
              <div class="bar" id="bar-sab" aria-label="S√°bado"></div>
              <div class="dayName">S√°b</div>
              <div class="dayHours" id="hours-sab">0.0h</div>
            </div>

            <div class="dayBar">
              <div class="bar" id="bar-dom" aria-label="Domingo"></div>
              <div class="dayName">Dom</div>
              <div class="dayHours" id="hours-dom">0.0h</div>
            </div>
          </div>

          <div class="sub" style="margin-top:10px;">
            Nota: aqu√≠ solo ves <b>horas efectivas</b>. El almuerzo se descuenta y no se suma en ning√∫n total.
          </div>
        </section>
      </section>

      <!-- PANEL: TOTALS -->
      <section
        class="panel isHidden"
        id="panel-totals"
        data-panel="totals"
        role="tabpanel"
        aria-labelledby="tab-totals"
      >
        <section class="card" aria-label="Totales">
          <div class="card__head">
            <div>
              <h2>Totales</h2>
              <div class="sub">Todo lo de ac√° es <b>efectivo</b> (sin almuerzo).</div>
            </div>
          </div>

          <div id="totalsGrid" class="totalsGrid">
            <!-- app.js llena esto -->
          </div>
        </section>
      </section>

      <!-- PANEL: KPI MENSUALES -->
      <section
        class="panel isHidden"
        id="panel-kpiMonth"
        data-panel="kpiMonth"
        role="tabpanel"
        aria-labelledby="tab-kpiMonth"
      >
        <section class="card" aria-label="KPIs mensuales">
          <div class="card__head">
            <div>
              <h2>KPIs mensuales</h2>
              <div class="sub">Indicadores con horas <b>efectivas</b>. El almuerzo se reporta aparte, no se suma.</div>
            </div>
          </div>

          <div class="kpiGrid">
            <div class="kpi">
              <div class="kpiLabel">D√≠a con mayor jornada efectiva (mes)</div>
              <div class="kpiValue" id="kpiTopDay">--</div>
              <div class="kpiHint" id="kpiTopDayHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Semana m√°s cargada (mes)</div>
              <div class="kpiValue" id="kpiTopWeek">--</div>
              <div class="kpiHint" id="kpiTopWeekHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Total del mes (efectivo)</div>
              <div class="kpiValue" id="kpiMonthTotal">--</div>
              <div class="kpiHint" id="kpiMonthTotalHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Promedio semanal (efectivo)</div>
              <div class="kpiValue" id="kpiWeekAvg">--</div>
              <div class="kpiHint" id="kpiWeekAvgHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">D√≠a de semana m√°s pesado (mes)</div>
              <div class="kpiValue" id="kpiTopWeekday">--</div>
              <div class="kpiHint" id="kpiTopWeekdayHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">D√≠as con jornada (mes)</div>
              <div class="kpiValue" id="kpiDaysWithJornada">--</div>
              <div class="kpiHint" id="kpiDaysWithJornadaHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">D√≠as donde aplica almuerzo</div>
              <div class="kpiValue" id="kpiLunchDays">--</div>
              <div class="kpiHint" id="kpiLunchDaysHint">Jornadas &gt; 6h (se descuenta 1h)</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Horas descontadas por almuerzo</div>
              <div class="kpiValue" id="kpiLunchHours">--</div>
              <div class="kpiHint" id="kpiLunchHoursHint">Total de horas descontadas este mes</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Total del mes (sin descuentos)</div>
              <div class="kpiValue" id="kpiRawTotal">--</div>
              <div class="kpiHint" id="kpiRawTotalHint">Solo informativo (no se usa para totales)</div>
            </div>
          </div>
        </section>
      </section>

      <!-- PANEL: KPI ANUALES -->
      <section
        class="panel isHidden"
        id="panel-kpiYear"
        data-panel="kpiYear"
        role="tabpanel"
        aria-labelledby="tab-kpiYear"
      >
        <section class="card" aria-label="KPIs anuales">
          <div class="card__head">
            <div>
              <h2>KPIs anuales</h2>
              <div class="sub">Indicadores del a√±o completo con horas <b>efectivas</b>. (Se calculan con los mismos datos).</div>
            </div>
          </div>

          <div class="kpiGrid">
            <div class="kpi">
              <div class="kpiLabel">Total anual (efectivo)</div>
              <div class="kpiValue" id="kpiYearTotal">--</div>
              <div class="kpiHint" id="kpiYearTotalHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Promedio mensual (efectivo)</div>
              <div class="kpiValue" id="kpiYearMonthAvg">--</div>
              <div class="kpiHint" id="kpiYearMonthAvgHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Mes m√°s cargado</div>
              <div class="kpiValue" id="kpiTopMonth">--</div>
              <div class="kpiHint" id="kpiTopMonthHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Semana m√°s cargada (a√±o)</div>
              <div class="kpiValue" id="kpiTopWeekYear">--</div>
              <div class="kpiHint" id="kpiTopWeekYearHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">D√≠a de semana m√°s pesado (a√±o)</div>
              <div class="kpiValue" id="kpiTopWeekdayYear">--</div>
              <div class="kpiHint" id="kpiTopWeekdayYearHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Horas descontadas por almuerzo (a√±o)</div>
              <div class="kpiValue" id="kpiLunchHoursYear">--</div>
              <div class="kpiHint" id="kpiLunchHoursYearHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">D√≠as con jornada (a√±o)</div>
              <div class="kpiValue" id="kpiDaysWithJornadaYear">--</div>
              <div class="kpiHint" id="kpiDaysWithJornadaYearHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">D√≠as sin jornada (a√±o)</div>
              <div class="kpiValue" id="kpiDaysWithoutJornadaYear">--</div>
              <div class="kpiHint" id="kpiDaysWithoutJornadaYearHint">--</div>
            </div>

            <div class="kpi">
              <div class="kpiLabel">Total anual (sin descuentos)</div>
              <div class="kpiValue" id="kpiYearRawTotal">--</div>
              <div class="kpiHint" id="kpiYearRawTotalHint">--</div>
            </div>
          </div>

          <div class="sub" style="margin-top:12px;">
            Nota: esta secci√≥n ya est√° lista para mostrarse. Solo falta que <code>app.js</code> pinte los valores anuales.
          </div>
        </section>
      </section>

      <!-- PANEL: DETALLES -->
      <section
        class="panel isHidden"
        id="panel-details"
        data-panel="details"
        role="tabpanel"
        aria-labelledby="tab-details"
      >
        <section class="card" aria-label="Detalles">
          <div class="card__head">
            <div>
              <h2>Detalles</h2>
              <div class="sub">Info de revisi√≥n r√°pida. Sigue siendo todo efectivo, solo m√°s ordenado.</div>
            </div>
          </div>

          <div style="margin-top:6px;">
            <div class="sub" style="margin-bottom:10px;">
              D√≠as donde aplic√≥ almuerzo (para revisar r√°pido):
            </div>
            <div id="lunchDaysList" class="lunchDaysList">
              <!-- app.js llena esto -->
            </div>
          </div>
        </section>
      </section>
    </main>

    <footer class="foot" role="contentinfo">
      <div class="sub">Hecho para que los n√∫meros no te mientan. Cosa rara en el mundo.</div>
      <noscript>
        <div class="sub" style="margin-top:8px;">
          Este planner necesita JavaScript para funcionar.
        </div>
      </noscript>
    </footer>
  </div>

  <script src="app.js"></script>

  <!-- Tabs: sin tocar tu app.js -->
  <script>
    (function(){
      const tabBtns = Array.from(document.querySelectorAll("[data-tab]"));
      const panels = Array.from(document.querySelectorAll("[data-panel]"));

      function setActive(tabKey, opts = { focus: false }) {
        // botones
        tabBtns.forEach(b => {
          const isOn = b.getAttribute("data-tab") === tabKey;
          b.classList.toggle("isActive", isOn);
          b.setAttribute("aria-selected", isOn ? "true" : "false");
          b.tabIndex = isOn ? 0 : -1;
          if (isOn && opts.focus) b.focus();
        });

        // paneles
        panels.forEach(p => {
          const isOn = p.getAttribute("data-panel") === tabKey;
          p.classList.toggle("isHidden", !isOn);
          p.hidden = !isOn;
        });

        try { localStorage.setItem("planner_active_tab", tabKey); } catch(e){}
      }

      tabBtns.forEach(btn => {
        btn.addEventListener("click", () => setActive(btn.getAttribute("data-tab"), { focus: false }));
      });

      // teclado: flechas para moverse por tabs
      tabBtns.forEach((btn, idx) => {
        btn.addEventListener("keydown", (e) => {
          const keys = ["ArrowLeft","ArrowRight","Home","End"];
          if (!keys.includes(e.key)) return;

          e.preventDefault();
          let nextIdx = idx;

          if (e.key === "ArrowLeft") nextIdx = (idx - 1 + tabBtns.length) % tabBtns.length;
          if (e.key === "ArrowRight") nextIdx = (idx + 1) % tabBtns.length;
          if (e.key === "Home") nextIdx = 0;
          if (e.key === "End") nextIdx = tabBtns.length - 1;

          const nextBtn = tabBtns[nextIdx];
          setActive(nextBtn.getAttribute("data-tab"), { focus: true });
        });
      });

      // default: main (o el √∫ltimo guardado)
      let saved = "main";
      try{
        const v = localStorage.getItem("planner_active_tab");
        if(v) saved = v;
      }catch(e){}

      const exists = tabBtns.some(b => b.getAttribute("data-tab") === saved);
      setActive(exists ? saved : "main", { focus: false });
    })();
  </script>
</body>
</html>